{% extends 'base.html' %}
{% load static %}

{% block title %}Home - Healthume{% endblock %}

{% block content %}
 
<!-- Displaying Messages -->
{% if messages %}
<div class="container mt-3">
  {% for message in messages %}
  <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
    {{ message }}
    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
  </div>
  {% endfor %}
</div>
{% endif %}

<!-- Featured Posts Carousel -->
<div class="row mb-5">
    {% if featured_posts %}
    <div class="col-md-8 offset-md-2">
        <div id="featuredCarousel" class="carousel slide mb-4" data-bs-ride="carousel" data-bs-interval="5000">
            <div class="carousel-inner">
                {% for post in featured_posts %}
                <div class="carousel-item {% if forloop.first %}active{% endif %}">
                    <a href="{% url 'blog:post_detail' post.slug %}" class="text-decoration-none text-dark d-block">
                        <div class="card featured-card text-center h-100">
                            <h6 class="text-uppercase text-muted mb-2 mt-2">Featured</h6>
                            {% if post.image %}
                            <img src="{{ post.image.url }}" alt="{{ post.title }}" style="width:150px; height:150px; object-fit:cover; border-radius:6px;">
                            {% endif %}
                            <div class="p-3">
                                <h4 class="card-title mb-2">{{ post.title }}</h4>
                                <p class="card-text text-muted small mb-0">{{ post.content|striptags|truncatewords:0}}</p>
                            </div>
                        </div>
                    </a>
                </div>
                {% endfor %}
            </div>

            <!-- Carousel Controls -->
            <button class="carousel-control-prev" type="button" data-bs-target="#featuredCarousel" data-bs-slide="prev">
                <span class="carousel-control-prev-icon" style="filter:invert(110%);" aria-hidden="true"></span>
                <span class="visually-hidden">Previous</span>
            </button>
            <button class="carousel-control-next" type="button" data-bs-target="#featuredCarousel" data-bs-slide="next">
                <span class="carousel-control-next-icon" style="filter:invert(110%);" aria-hidden="true"></span>
                <span class="visually-hidden">Next</span>
            </button>

            <!-- Carousel Indicators -->
            <div class="carousel-indicators">
                {% for post in featured_posts %}
                <button type="button" data-bs-target="#featuredCarousel" data-bs-slide-to="{{ forloop.counter0 }}"
                        class="{% if forloop.first %}active{% endif %}" aria-current="true" aria-label="Slide {{ forloop.counter }}"></button>
                {% endfor %}
            </div>
        </div>
    </div>
    {% else %}
    <div class="col-12 text-center">
        <div class="alert alert-info" role="alert">
            No featured posts yet. Mark some as 'featured' in the admin panel under Blog â†’ Posts!
        </div>
    </div>
    {% endif %}
</div>

<!-- Trending Now Section -->
<div class="row">
    <div class="col-md-8">
        <h3 class="mb-4">Trending Now</h3>
        <div class="list-group mb-5">
            {% for post in trending_posts %}
            <a href="{% url 'blog:post_detail' post.slug %}"
                class="list-group-item list-group-item-action d-flex flex-column flex-md-row align-items-md-center mb-3 p-3 trending-item">
                {% if post.image %}
                <img src="{{ post.image.url }}" class="me-md-3 mb-2 mb-md-0 rounded" alt="{{ post.title }}" style="width: 100px; height: 100px; object-fit: cover;">
                {% endif %}
                <div class="flex-grow-1">
                    <h5 class="mb-1">{{ post.title }}</h5>
                    <p class="mb-1 text-muted small">{{ post.content|striptags|truncatewords:10 }}</p>
                    <small class="text-muted">{{ post.published_date|date:"F d, Y" }}</small>
                </div>
            </a>
            {% empty %}
            <div class="alert alert-warning" role="alert">
                No trending posts available. Add some articles!
            </div>
            {% endfor %}
        </div>

        <h3 class="mb-4">More Top Reads</h3>
        <div class="row">
            {% for post in more_top_reads %}
            <div class="col-md-6 mb-4">
                <div class="card h-100 shadow-sm top-read-card">
                    {% if post.image %}
                    <img src="{{ post.image.url }}" class="card-img-top" alt="{{ post.title }}" style="height: 180px; object-fit: cover;">
                    {% endif %}
                    <div class="card-body d-flex flex-column">
                        <h5 class="card-title">{{ post.title }}</h5>
                        <p class="card-text text-muted small">{{ post.content|striptags|truncatewords:10 }}</p>
                        <div class="mt-auto">
                            <a href="{% url 'blog:post_detail' post.slug %}" class="btn btn-outline-primary btn-sm">Read More</a>
                        </div>
                    </div>
                </div>
            </div>
            {% empty %}
            <div class="col-12">
                <div class="alert alert-warning" role="alert">
                    No more top reads available.
                </div>
            </div>
            {% endfor %}
        </div>
    </div>

    <!-- Sidebar Section -->
    <div class="col-md-4">
        <div class="card sidebar-card mb-4 shadow-sm">
            <div class="card-body">
                <h5 class="card-title mb-3">Explore By Category</h5>
                <ul class="list-group list-group-flush">
                    {% for category in blog_categories %}
                    <li class="list-group-item d-flex justify-content-between align-items-center">
                        <a href="{% url 'blog:post_by_category' category.slug %}" class="text-decoration-none">{{ category.name }}</a>
                        <span class="badge bg-primary rounded-pill">{{ category.post_count }}</span>
                    </li>
                    {% empty %}
                    <li class="list-group-item text-muted">No categories created yet.</li>
                    {% endfor %}
                </ul>
            </div>
        </div>

        <!-- Newsletter Section -->
        <div class="card sidebar-card mb-4 shadow-sm bg-primary text-white">
            <div class="card-body">
                <h5 class="card-title text-center mb-3">Get our wellness newsletter</h5>
                <p class="card-text text-center small">
                    Filter out the noise and nurture your inbox with health and wellness advice that's inclusive and rooted in medical expertise.
                </p>
                <form action="{% url 'blog:newsletter_signup' %}" method="POST">
                    {% csrf_token %}
                    <div class="mb-3">
                        <input type="email" name="email" class="form-control" placeholder="Your email address" required>
                    </div>
                    <div class="d-grid">
                        <button type="submit" class="btn btn-warning">Get Health Tips Direct to Your Inbox</button>
                    </div>
                    <p class="text-center small mt-2">Your privacy is important to us. We'll never share your information.</p>
                </form>
            </div>
        </div>
    </div>
</div>

{% endblock %}
